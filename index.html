<html>
<head>
<title>Vue.js Pet Depot</title>
<script src="https://unpkg.com/vue"></script>
<link rel="stylesheet" type="text/css" href="assets/css/app.css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.2/axios.js"></script>
</head>
<body>
    <div id="app">
        <header>
            <div class="navbar navbar-default">
                <h1>{{ sitename }}</h1>
            </div>
            <div class="nav navbar-nav cart navbar-right">
                <button class="btn btn-default btn-lg"
                    @click="showCheckout"
                >
                <span
                    class="glyphicon glyphicon-shopping-cart"
                >{{ cartItemCount }}</span>
                Checkout
                </button>
            </div>
        </header>
        <main>
            <div class="row product">
                <div v-if="showProduct">
                    <div class="col-xs-6">
                            <figure>
                                <img v-bind:src="product.image">
                            </figure>
                    </div>                    
                    <div class="col-xs-6 col-expand">
                        <h1 v-text="product.title"></h1>
                        <p v-html="product.description"></p>
                        <p v-text="product.price"></p>
                        <button 
                            class="btn btn-success"
                            @click="addToCart"
                            v-if="canAddToCart"
                        >Add to cart
                        </button>
                        <button 
                            class="btn disabled"
                            v-else
                        >Add to cart
                        </button>
                        <span 
                            class="inventory-message"
                            v-if="product.availableInventory - cartItemCount == 0">
                            All Out!
                        </span>
                        <span 
                            class="inventory-message"
                            v-else-if="product.availableInventory - cartItemCount < 5">
                            Only {{ product.availableInventory - cartItemCount }} left!
                        </span>
                        <span 
                            class="inventory-message"
                            v-else>
                            Buy Now!
                        </span>
                        <div class="rating">
                            <span 
                                v-for="n in 5"
                                v-bind:class="{'rating-active': checkRating(n)}"
                            >&#9734;</span>
                        </div>
                    </div>
                </div>
                <div v-else>
                    <div class="col-md-6">
                        <strong>First name:</strong>
                        <input v-model.trim.lazy="order.firstName" 
                            class="form-control" />
                    </div>
                    <div class="col-md-6">
                        <strong>Last name:</strong>
                        <input v-model.trim.lazy="order.lastName" 
                            class="form-control" />
                    </div>                                     
                    <div class="form-group">
                        <div class="col-md-12">
                            <strong>Address:</strong>
                        </div>
                        <div class="col-md-12">
                            <input v-model.trim.lazy="order.address" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-12">
                            <strong>City:</strong>
                        </div>
                        <div class="col-md-12">
                            <input v-model.trim.lazy="order.city" class="form-control" />
                        </div>
                    </div>    
                    <div class="form-group">
                        <div class="col-md-12">
                            <strong>State:</strong>
                            <select
                                v-model="order.state"
                                class="form-control"
                            >
                                <option disabled value="">State</option>
                                <option 
                                    v-for="(state, key) in states"
                                    v-bind:value="state"
                                >
                                {{ key }}
                                </option>

                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-6 col-md-offset-4">
                            <strong>Zip Postal Code:</strong>
                            <input v-model.number="order.zip" class="form-control" />
                        </div>
                    </div>  
                    <div class="form-group">
                        <div class="col-md-6 boxes">
                            <input 
                                type="checkbox"
                                id="gift"
                                value="true"
                                v-bind:true-value="order.sendGift"
                                v-bind:false-value="order.dontSendGift"
                                v-model="order.gift" />
                            <label for="gift">Ship as gift?</label>
                        </div>
                    </div> 
                    <div class="form-group">
                        <div class="col-md-6 boxes">
                            <input 
                                type="radio"
                                id="home"
                                v-bind:value="order.home"
                                v-model="order.method"
                            />
                            <label for="home">Home</label>
                            <input 
                                type="radio"
                                id="business"
                                v-bind:value="order.business"
                                v-model="order.method"
                            />
                            <label for="business">Business</label>
                        </div> 
                    </div>                      
                    <div class="col-md-12 verify">
                        <pre>
                            First Name: {{ order.firstName }}
                            Last Name: {{ order.lastName }}
                            Address: {{ order.address }}
                            City: {{ order.city }}
                            Zip: {{ order.zip }}
                            State: {{ order.state }}
                            Method: {{ order.method }}
                            Gift: {{ order.gift }}
                        </pre>
                    </div>    
                    <div class="form-group">
                        <div class="col-md-6">
                            <button 
                                type="submit"
                                class="btn btn-primary submit"
                                @click="submitForm"
                            >Place Order</button>
                        </div>
                    </div>        
                </div>
            </div>
        </main>
    </div>
</body >
<script>
    var webstore = new Vue({
    el: "#app",
    data: {
        sitename: "Vue.js shop project",
        products: [],
        product: {
            id: 1001,
            title: "Cat food",
            description: "Some food for cat with. Such <em>tasty</em>",
            price: 1000,
            image: "assets/images/product-fullsize.png",
            availableInventory: 10,
            rating: 3
        },
        cart: [],
        showProduct: true,
        states: {
            AL: "Alabama",
            AR: "Arizona",
            CA: "California",
            NV: "Nevada"
        },
        order: {
            lastName: '',
            firstName: '',
            address: '',
            city: '',
            zip: '',
            state: '',
            method: 'Home address',
            home: 'Home address',
            business: 'Business address',
            gift: "Send as gift",
            sendGift: "Send as gift",
            dontSendGift: "So not send as a gift"
        }
    },
    methods: {
        addToCart: function(){
            console.log(`Call add to cart for ${this.product.id}`)
            this.cart.push( this.product.id )
        },
        showCheckout() {
            this.showProduct = !this.showProduct
        },
        submitForm() {
            alert('Submitted')
        },
        checkRating(n) {
            return this.product.rating - n >=0
        }
    },
    computed: {
        cartItemCount: function(){
            return this.cart.length || 0
        },
        canAddToCart: function(){
            return this.product.availableInventory > this.cartItemCount
        }
    },
    created: function(){
        axios.get("./products.json")
        .then((response) => {
            this.products = response.data.products;
            console.log(this.products)
        })
    }
    });

    console.log(webstore)
</script>
</html>